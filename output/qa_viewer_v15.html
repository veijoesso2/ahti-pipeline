<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahti QA: Portages & Culverts (v15)</title>
    <script src='https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #legend {
            position: absolute; top: 20px; right: 20px; 
            background: white; padding: 15px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 220px;
            z-index: 100;
        }
        .item { margin-bottom: 8px; display: flex; align-items: center; font-size: 13px; }
        .line { width: 20px; height: 4px; margin-right: 8px; display: inline-block; }
    </style>
</head>
<body>
    <div id="legend">
        <h3>üîç v15 Inspection</h3>
        
        <div class="item">
            <span class="line" style="background: #9333ea; height: 3px;"></span>
            <strong>Culvert (Healed Gap)</strong>
        </div>
        <div class="item">
            <span class="line" style="background: #f97316; border-bottom: 2px dashed #f97316;"></span>
            <strong>Road Portage (>500m)</strong>
        </div>
        <div class="item">
            <span class="line" style="background: #0ea5e9; border-bottom: 2px dashed #0ea5e9;"></span>
            <strong>Direct Portage (<500m)</strong>
        </div>
        <div class="item">
            <span class="line" style="background: #94a3b8;"></span>
            River
        </div>
    </div>
    
    <div id="map"></div>

    <script>
        const map = new maplibregl.Map({
            container: 'map',
            style: {
                version: 8,
                sources: {
                    'carto': { type: 'raster', tiles: ['https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png'], tileSize: 256 }
                },
                layers: [{ id: 'base', type: 'raster', source: 'carto' }]
            },
            center: [24.0, 60.0], 
            zoom: 12
        });

        map.on('load', async () => {
            const res = await fetch('./debug_data_v15.json');
            const data = await res.json();
            map.addSource('debug', { type: 'geojson', data: data });

            // 1. RIVERS
            map.addLayer({
                id: 'rivers', type: 'line', source: 'debug',
                filter: ['==', 'type', 'river'],
                paint: { 'line-color': '#94a3b8', 'line-width': 3 }
            });

            // 2. CULVERTS (Purple)
            map.addLayer({
                id: 'culverts', type: 'line', source: 'debug',
                filter: ['==', 'name', 'Culvert'],
                paint: { 'line-color': '#9333ea', 'line-width': 4 }
            });

            // 3. DIRECT PORTAGES (Blue Dashed)
            map.addLayer({
                id: 'portage-direct', type: 'line', source: 'debug',
                filter: ['==', 'name', 'Portage'],
                paint: { 
                    'line-color': '#0ea5e9', 
                    'line-width': 3, 
                    'line-dasharray': [2, 1] 
                }
            });

            // 4. ROAD PORTAGES (Orange Dashed)
            map.addLayer({
                id: 'portage-road', type: 'line', source: 'debug',
                filter: ['==', 'name', 'Road Portage'],
                paint: { 
                    'line-color': '#f97316', 
                    'line-width': 3, 
                    'line-dasharray': [3, 2] 
                }
            });
            
            // 5. LAKE ROUTES (Light Blue)
            map.addLayer({
                id: 'lake-routes', type: 'line', source: 'debug',
                filter: ['==', 'name', 'Lake Route'],
                paint: { 'line-color': '#bae6fd', 'line-width': 2 }
            });
        });
    </script>
</body>
</html>